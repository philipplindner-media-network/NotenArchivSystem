<!DOCTYPE html>
<html>
<head>
    <title>Notenarchiv</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .footer {
            background-color: #343a40; /* Dark background for footer */
            color: #ffffff;
            padding: 20px;
            text-align: center;
            margin-top: auto; /* Pushes footer to the bottom */
            width: 100%;
        }
        .footer a {
            color: #17a2b8; /* Bootstrap info color */
            text-decoration: none;
            margin: 0 10px;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .table img {
            max-width: 100px; /* Limit image size in table */
            height: auto;
        }
        .form-label-small { /* Custom style for the small label above new folder input */
            font-size: 0.875em;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <header>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flashes">
      {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
        <div>
            <img src="{{ url_for('static', filename='logo.png') }}" width="150" alt="Logo">
        </div>
        <div>
            Eingeloggt als <strong>{{ session['benutzer'] }}</strong> |
            <a href="/logout" class="btn btn-sm btn-outline-secondary">Logout</a>
        </div>
    </header>
    <main class="container py-4">
        <h1 class="mb-4">üéº Notenarchiv</h1>

        <form method="POST" enctype="multipart/form-data" class="mb-4 p-3 border rounded bg-light">
            <h5 class="mb-3">Neue Note hochladen</h5>
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="titel" class="form-label">Titel</label>
                    <input name="titel" id="titel" class="form-control" placeholder="Titel der Note" required>
                </div>
                <div class="col-md-4">
                    <label for="ordner" class="form-label">Ordner (optional)</label>
                    <select name="ordner" id="ordner" class="form-select mb-1">
                        <option value="">-- Kein Ordner --</option>
                        {% for ordner in ordner_liste %}
                            <option value="{{ ordner }}">{{ ordner }}</option>
                        {% endfor %}
                    </select>
                    <small class="form-text text-muted">Oder neuen Ordner eingeben:</small>
                    <input type="text" name="ordner_neu" class="form-control mt-1" placeholder="Neuer Ordnername">
                </div>
                <div class="col-md-3">
                    <label for="file" class="form-label">PDF-Datei</label>
                    <input type="file" name="file" id="file" accept=".pdf" class="form-control" required>
                </div>
                <div class="col-md-1 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Hochladen</button>
                </div>
            </div>
        </form>

        <form method="GET" class="mb-4">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Suche nach Titel oder ID" value="{{ query }}">
                <button type="submit" class="btn btn-outline-secondary">Suchen</button>
            </div>
        </form>
        
        <hr class="my-4">
        <a href="/notizen-pdf" class="btn btn-info mb-4" target="_blank">PDF-Liste deiner Noten</a>

        <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Titel</th>
                        <th>Ordner</th>
                        <th>ID</th>
                        <th>PDF</th>
                        <th>QR</th>
                        <th>Barcode</th>
                        <th>Aktion</th>
                        <th>Teilen?</th>
                    </tr>
                </thead>
                <tbody>
                    {% for note in noten %}
                        <tr>
                            <td>{{ note["titel"] }}</td>
                            <td>{{ note["ordner"] }}</td>
                            <td>{{ note["code"] }}</td>
                            <td><a href="/download/{{ note["dateiname"] }}" class="text-decoration-none">{{ note["dateiname"] }}</a></td>
                            <td><img src="/static/cod/{{ note["code"] }}_qr.png" width="80" alt="QR Code"></td>
                            <td><img src="/static/cod/{{ note["code"] }}_barcode.png" height="80" alt="Barcode"></td>
                            <td>
                                <a href="/edit/{{ note["id"] }}" class="btn btn-sm btn-warning me-1" title="Bearbeiten">‚úèÔ∏è</a>
                                <a href="/delete/{{ note["id"] }}" class="btn btn-sm btn-danger" onclick="return confirm('Wirklich l√∂schen?')" title="L√∂schen">üóëÔ∏è</a>
                            </td>
                            <td><a href="{{ url_for('share', note_id=note.id) }}" class="btn btn-sm btn-outline-primary">Freigeben</a></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <footer class="footer">
        <div>¬© {{ datetime.utcnow().year }} Notenarchiv System by Philipp Lindner mit Unterst√ºtzung von Chat GPT</div>
        <div>Erstellt mit Flask ‚ù§Ô∏è</div>
        <div>
            <a href="/impressum">Impressum</a>|
            <a href="{{ url_for('info') }}">Info / Funktionen</a>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
